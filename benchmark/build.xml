<?xml version="1.0" encoding="UTF-8"?>
<project name="Benchmark" default="all" basedir=".">
	<exec executable="hostname" failifexecutionfails="true" outputproperty="env._HOST_" />
	<property environment="env"/>
	<property name="tools" value="${env.PWD}/tools"/>
	<property name="src.common.dir" value="src/bench/common" />
	<property name="src.ig3.dir" value="src/bench/ig3" />
	<property name="src.main.dir" value="src/bench/main" />
	<property name="build.dir" value="build" />
	<property name="build.classes" value="${build.dir}/classes" />
	<property name="build.jar" value="${build.dir}/jar" />
	<property name="build.lib" value="${build.dir}/lib" />
	<property name="ig3.root" value="${env.IG_HOME}"/>
	<property name="ig3.lib" value="${ig3.root}/lib"/>
	<property name="tool.lib" value="${env.PWD}/tools/lib"/>
	<property name="neo.jars" value="${env.PWD}/neo-jars" />
	    
	<target name="prepare" description="Preparing build directory">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.classes}" />
		<mkdir dir="${build.jar}" />
		<mkdir dir="${build.lib}"/>
	</target>	


	<target name="clean" description="Remove all generated files.">
		<delete dir="${build.dir}" />
	</target>
        
	<target name="common-compile" depends="prepare" description="Compile all source code.">
		<javac srcdir="${src.common.dir}" destdir="${build.classes}" includeantruntime="false" debug="true" debuglevel="lines,source">
		</javac>
	</target>
        
   <target name="ig3-compile" depends="common-compile" description="Compile all source code.">
		<javac srcdir="${src.ig3.dir}" destdir="${build.classes}" includeantruntime="false" debug="true" debuglevel="lines,source">
			<classpath location="${ig3.lib}/InfiniteGraph.jar"/>
		</javac>
	</target>

	<target name="ig-jar" depends="ig3-compile" description="Compile all source code.">
		<jar jarfile="${build.dir}/ig.jar" basedir="${build.classes}">
			<manifest>
		 		<attribute name="Class-Path" value="${ig.lib}/InfiniteGraph.jar"/>
			</manifest>
		</jar>  
	</target>

	<target name="neo-embedded-compile" depends="common-compile" description="Compile all source code.">
                <javac srcdir="${src.neo_embedded.dir}" destdir="${build.classes}" includeantruntime="false" debug="true" debuglevel="lines,source">
                <classpath location="${neo.jars}/neo4j-kernel-1.5.M01.jar"/>
                <classpath location="${neo.jars}/neo4j-lucene-index-1.5.M01.jar"/>  
                <classpath location="${neo.jars}/jersey-client-1.4.jar"/>               
                <classpath location="${neo.jars}/jersey-core-1.4.jar"/>     
                <classpath location="${tools}/pngj-0.62/pngj.jar"/>                            
                </javac>
    </target>


 	<target name="neo-embedded-jar" depends="neo-embedded-compile" description="Compile all source code.">
                <jar jarfile="${build.dir}/neo.jar" basedir="${build.classes}">
                        <manifest>
                                <attribute name="Class-Path" value="${neo.jars}/neo4j-kernel-1.5.M01.jar"/>
                        </manifest>
                </jar>  
   </target>



	<target name="neo-server-compile" depends="common-compile" description="Compile all source code.">
                <javac srcdir="${src.neo_server.dir}" destdir="${build.classes}" includeantruntime="false" debug="true" debuglevel="lines,source">
                <classpath location="${neo.jars}/neo4j-kernel-1.5.M01.jar"/>
                <classpath location="${neo.jars}/neo4j-lucene-index-1.5.M01.jar"/>  
                <classpath location="${neo.jars}/jersey-client-1.4.jar"/>               
                <classpath location="${neo.jars}/jersey-core-1.4.jar"/>    
                <classpath location="${tools}/pngj-0.62/pngj.jar"/>                             
				<classpath location="${tools}/lib/json_simple-1.1.jar"/>
            </javac>
    </target>

	<target name="neo-server-jar" depends="neo-server-compile" description="Compile all source code.">
                <jar jarfile="${build.dir}/neo_server.jar" basedir="${build.classes}">
                        <manifest>
                                <attribute name="Class-Path" value="${neo.jars}/neo4j-kernel-1.5.M01.jar"/>
                        </manifest>
                </jar>  
   </target>


	<target name="benchmark-compile" depends="common-compile" description="Compile all source code.">
		<javac srcdir="${src.main.dir}" destdir="${build.classes}" includeantruntime="false" debug="true" debuglevel="lines,source">
			<classpath location="${tool.lib}/commons-cli-1.2.jar"/>
			<classpath location="${build.jar}/ig.jar"/>
			<classpath location="${build.jar}/neo_server.jar"/>	
			<classpath location="${build.jar}/neo_embedded.jar"/>
		</javac>
	</target>
				
	<target name="benchmark-jar" depends="benchmark-compile,neo-embedded-jar,neo-server-jar" description="Generate Benchmark main.">
		<jar jarfile="${build.dir}/benchmark.jar" basedir="${build.classes}">
			<manifest>
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Main-Class" value="bench.main.Benchmark"/>
				<attribute name="Class-Path" value="
				${build.dir}/ig.jar 
				${build.dir}/neo_server.jar 
				${build.dir}/neo_embedded.jar 
				${neo.jars}/lucene-core-3.1.0.jar
				${neo.jars}/neo4j-kernel-1.5.M01.jar 
				${neo.jars}/geronimo-jta_1.1_spec-1.1.1.jar  
				${neo.jars}/neo4j-lucene-index-1.5.M01.jar 
				${neo.jars}/jersey-client-1.4.jar 
				${neo.jars}/jersey-core-1.4.jar 
				${tool.lib}/commons-cli-1.2.jar 
				${tools}/pngj-0.62/pngj.jar
				${tools}/lib/json_simple-1.1.jar
				${ig.lib}/InfiniteGraph.jar 
				${ig.lib}/slf4j-simple-1.6.1.jar"/>
			</manifest>
		</jar>	
	</target>
	

	<target name="all" depends="neo-server-jar,neo-embedded-jar,ig-jar,benchmark-jar" description="Build all targets (clean,jar).">
	</target>
</project>
